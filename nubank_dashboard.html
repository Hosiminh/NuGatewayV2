<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NuBank Smart Monitoring • NuTeknoloji</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    :root { 
      --bg:#0a0e1a; 
      --card:#111827; 
      --primary:#6366f1;
      --ok:#22c55e; 
      --warn:#f59e0b; 
      --bad:#ef4444;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body{ 
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; 
      background: radial-gradient(ellipse at top, #1e293b 0%, #0f172a 50%, #020617 100%);
      background-attachment: fixed;
      min-height: 100vh;
    }
    .card{ 
      background: linear-gradient(145deg, rgba(30,41,59,0.6), rgba(15,23,42,0.4)); 
      border:1px solid rgba(99,102,241,0.15); 
      box-shadow: 0 4px 24px -4px rgba(0,0,0,0.4), 0 0 0 1px rgba(99,102,241,0.08), inset 0 1px 0 rgba(255,255,255,0.03);
      backdrop-filter: blur(24px);
      border-radius: 20px;
      position: relative;
      overflow: hidden;
    }
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(99,102,241,0.3), transparent);
    }
    .glass{ backdrop-filter: blur(20px); }
    .dot{ 
      width:14px; 
      height:14px; 
      border-radius:50%; 
      display:inline-block; 
      position: relative;
    }
    .dot::after {
      content: '';
      position: absolute;
      inset: -4px;
      border-radius: 50%;
      background: inherit;
      opacity: 0.3;
      animation: ping 2s cubic-bezier(0, 0, 0.2, 1) infinite;
    }
    @keyframes ping {
      75%, 100% { transform: scale(2); opacity: 0; }
    }
    .status-ok{ background:#22c55e; box-shadow: 0 0 20px rgba(34,197,94,0.5); }
    .status-warn{ background:#f59e0b; box-shadow: 0 0 20px rgba(245,158,11,0.5); }
    .status-bad{ background:#ef4444; box-shadow: 0 0 20px rgba(239,68,68,0.5); }
    .status-off{ background:#6b7280; }
    .chip{ 
      font-size:11px; 
      padding:.4rem .9rem; 
      border-radius:999px; 
      background:rgba(99,102,241,.15); 
      border:1px solid rgba(99,102,241,.3); 
      color:#c7d2fe; 
      font-weight:700;
      letter-spacing: 0.3px;
      text-transform: uppercase;
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 8px rgba(99,102,241,0.2);
    }
    .chip-ok{ background:rgba(34,197,94,.15); border-color:rgba(34,197,94,.35); color:#86efac; box-shadow: 0 2px 8px rgba(34,197,94,0.2); }
    .chip-warn{ background:rgba(245,158,11,.15); border-color:rgba(245,158,11,.35); color:#fde047; box-shadow: 0 2px 8px rgba(245,158,11,0.2); }
    .chip-bad{ background:rgba(239,68,68,.15); border-color:rgba(239,68,68,.35); color:#fca5a5; box-shadow: 0 2px 8px rgba(239,68,68,0.2); }
    .btn{ 
      border:1px solid rgba(99,102,241,.35); 
      padding:.6rem 1.1rem; 
      border-radius:.8rem; 
      background:rgba(99,102,241,.12); 
      color:#e0e7ff; 
      font-weight:700; 
      font-size: 13px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      backdrop-filter: blur(10px);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      cursor: pointer;
    }
    .btn:hover{ 
      background:rgba(99,102,241,.25); 
      transform: translateY(-2px); 
      box-shadow: 0 10px 30px rgba(99,102,241,.5); 
      border-color:rgba(99,102,241,.6);
    }
    .progress-bar{ 
      height:12px; 
      background:rgba(15,23,42,0.5); 
      border-radius:999px; 
      overflow:hidden;
      border: 1px solid rgba(99,102,241,.15);
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
      position: relative;
    }
    .progress-fill{ 
      height:100%; 
      transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: shimmer 2s infinite;
    }
    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    .gradient-ok{ background:linear-gradient(90deg, #22c55e, #10b981, #059669); box-shadow: 0 0 20px rgba(34,197,94,0.4); }
    .gradient-warn{ background:linear-gradient(90deg, #f59e0b, #d97706, #b45309); box-shadow: 0 0 20px rgba(245,158,11,0.4); }
    .gradient-bad{ background:linear-gradient(90deg, #ef4444, #dc2626, #b91c1c); box-shadow: 0 0 20px rgba(239,68,68,0.4); }
    canvas{ display:block; width:100% !important; height:auto !important; }
    .chartwrap{ 
      height:200px; 
      border-radius:1rem; 
      border:1px solid rgba(99,102,241,.1); 
      background:rgba(0,0,0,.2); 
      padding:16px;
      box-shadow: inset 0 2px 8px rgba(0,0,0,0.2);
    }
    .risk-badge{ 
      display:inline-flex; 
      align-items:center; 
      gap:0.5rem; 
      padding:.5rem 1rem; 
      border-radius:.7rem; 
      font-size:12px; 
      font-weight:800;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    .risk-low{ background:rgba(34,197,94,.2); color:#86efac; border:1px solid rgba(34,197,94,.4); }
    .risk-med{ background:rgba(245,158,11,.2); color:#fde047; border:1px solid rgba(245,158,11,.4); }
    .risk-high{ background:rgba(239,68,68,.2); color:#fca5a5; border:1px solid rgba(239,68,68,.4); }
    .metric-big{ 
      font-size:3.5rem; 
      font-weight:900; 
      line-height:1; 
      background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 30%, #a5b4fc 60%, #818cf8 100%); 
      -webkit-background-clip: text; 
      -webkit-text-fill-color: transparent;
      filter: drop-shadow(0 0 30px rgba(99,102,241,0.5));
    }
    .metric-value {
      font-size: 2.5rem;
      font-weight: 800;
      line-height: 1;
      letter-spacing: -0.02em;
    }
    .glow-card{ 
      animation: glow-pulse 4s ease-in-out infinite; 
    }
    @keyframes glow-pulse { 
      0%, 100% { box-shadow: 0 0 30px rgba(99,102,241,0.2), 0 4px 24px -4px rgba(0,0,0,0.4); } 
      50% { box-shadow: 0 0 50px rgba(99,102,241,0.4), 0 8px 40px -8px rgba(0,0,0,0.6); } 
    }
    .icon-box{
      width: 64px;
      height: 64px;
      border-radius: 18px;
      display: grid;
      place-items: center;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 16px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.1);
    }
    .icon-box::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: 18px;
      padding: 2px;
      background: linear-gradient(135deg, rgba(99,102,241,0.4), rgba(168,85,247,0.4));
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
    }
    .icon-gradient-1{ background: linear-gradient(135deg, rgba(99,102,241,0.25), rgba(139,92,246,0.25)); }
    .icon-gradient-2{ background: linear-gradient(135deg, rgba(34,197,94,0.25), rgba(16,185,129,0.25)); }
    .icon-gradient-3{ background: linear-gradient(135deg, rgba(251,191,36,0.25), rgba(245,158,11,0.25)); }
    .icon-gradient-4{ background: linear-gradient(135deg, rgba(59,130,246,0.25), rgba(147,51,234,0.25)); }
    .icon-gradient-5{ background: linear-gradient(135deg, rgba(239,68,68,0.25), rgba(220,38,38,0.25)); }
    .relay-card{
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      position: relative;
    }
    .relay-card:hover{
      transform: translateY(-6px) scale(1.02);
      box-shadow: 0 20px 60px -10px rgba(0,0,0,0.8), 0 0 0 1px rgba(99,102,241,0.2);
    }
    .relay-active{
      background: linear-gradient(145deg, rgba(34,197,94,0.15), rgba(16,185,129,0.1));
      border-color: rgba(34,197,94,0.4);
      box-shadow: 0 0 40px rgba(34,197,94,0.3), 0 4px 24px -4px rgba(0,0,0,0.4);
    }
    .relay-active::after {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: 20px;
      background: linear-gradient(135deg, rgba(34,197,94,0.1), transparent);
      pointer-events: none;
    }
    .section-title {
      font-size: 1.25rem;
      font-weight: 800;
      letter-spacing: -0.01em;
    }
    .data-card {
      background: linear-gradient(145deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
      padding: 1.25rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.03);
    }
    .logo-glow {
      filter: drop-shadow(0 0 20px rgba(99,102,241,0.6));
    }
  </style>
</head>
<body class="text-slate-100">
  
  <!-- Header -->
  <header class="sticky top-0 z-30 glass card border-b border-indigo-500/20" style="border-radius: 0;">
    <div class="mx-auto max-w-[1900px] px-8 py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-5">
          <img src="/static/logo.png" alt="NuTeknoloji" class="h-14 w-auto logo-glow" />
          <div class="h-12 w-px bg-gradient-to-b from-transparent via-indigo-500/30 to-transparent"></div>
          <div>
            <h1 class="text-2xl font-black tracking-tight">NuBank Smart Monitoring</h1>
            <p class="text-sm text-slate-400 font-medium" id="headerLocation">Sistem başlatılıyor...</p>
          </div>
        </div>
        
        <div class="flex items-center gap-5">
          <div class="text-right hidden lg:block">
            <div id="clock" class="text-xl font-bold text-indigo-300"></div>
            <div class="text-xs text-slate-500 font-semibold uppercase tracking-wider">Sistem Saati</div>
          </div>
          
          <div class="h-12 w-px bg-gradient-to-b from-transparent via-indigo-500/30 to-transparent hidden lg:block"></div>
          
          <span class="chip" id="deviceChip">DEVICE: -</span>
          
          <div class="flex items-center gap-3 px-4 py-2.5 rounded-xl bg-gradient-to-r from-white/5 to-white/0 border border-white/10">
            <span class="dot status-ok" id="statusDot"></span>
            <div>
              <div class="text-xs text-slate-500 font-semibold uppercase tracking-wider">Status</div>
              <div class="text-sm font-bold" id="statusText">Online</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="mx-auto max-w-[1900px] p-8 grid grid-cols-12 gap-6">

    <!-- Battery Card -->
    <section class="col-span-12 lg:col-span-4 card p-7 glow-card">
      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center gap-4">
          <div class="icon-box icon-gradient-2">
            <svg class="w-8 h-8 text-green-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
              <rect x="2" y="7" width="16" height="10" rx="2"/><path d="M18 10h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-2"/>
              <path d="M6 10v4M10 10v4"/>
            </svg>
          </div>
          <h2 class="section-title">Batarya</h2>
        </div>
        <span class="chip-ok" id="batteryChip">NORMAL</span>
      </div>
      
      <div class="mb-6">
        <div class="flex justify-between items-end mb-3">
          <span class="text-sm text-slate-400 font-semibold uppercase tracking-wide">Şarj Seviyesi</span>
          <span class="metric-big" id="bmsSoc">0%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill gradient-ok" id="batteryProgress" style="width:0%"></div>
        </div>
      </div>
      
      <div class="grid grid-cols-2 gap-4 mb-5">
        <div class="data-card">
          <div class="text-xs text-slate-400 mb-2 font-semibold uppercase tracking-wide">Voltaj</div>
          <div class="metric-value text-green-400" id="bmsVoltage">-V</div>
        </div>
        <div class="data-card">
          <div class="text-xs text-slate-400 mb-2 font-semibold uppercase tracking-wide">Akım</div>
          <div class="metric-value text-green-400" id="bmsCurrent">-A</div>
        </div>
        <div class="data-card">
          <div class="text-xs text-slate-400 mb-2 font-semibold uppercase tracking-wide">Güç</div>
          <div class="metric-value text-green-400" id="bmsPower">-W</div>
        </div>
        <div class="data-card">
          <div class="text-xs text-slate-400 mb-2 font-semibold uppercase tracking-wide">Sağlık</div>
          <div class="metric-value text-green-400" id="bmsSoh">-%</div>
        </div>
      </div>
      
      <div class="p-5 rounded-2xl bg-gradient-to-r from-indigo-500/15 to-purple-500/15 border border-indigo-500/25">
        <div class="flex items-center gap-2 mb-2">
          <svg class="w-5 h-5 text-indigo-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/>
          </svg>
          <div class="text-xs text-slate-400 font-bold uppercase tracking-wide">Kalan Süre Tahmini</div>
        </div>
        <div class="text-2xl font-black text-indigo-300" id="batteryEstimate">Hesaplanıyor...</div>
      </div>
    </section>

    <!-- Solar Card -->
    <section class="col-span-12 lg:col-span-4 card p-7">
      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center gap-4">
          <div class="icon-box icon-gradient-3">
            <svg class="w-8 h-8 text-amber-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
              <circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/>
            </svg>
          </div>
          <h2 class="section-title">Solar MPPT</h2>
        </div>
        <span class="chip" id="solarStatus">ACTIVE</span>
      </div>
      
      <div class="grid grid-cols-2 gap-4 mb-5">
        <div class="data-card">
          <div class="text-xs text-slate-400 mb-2 font-semibold uppercase tracking-wide">PV Voltaj</div>
          <div class="metric-value text-amber-400" id="pvVoltage">-V</div>
        </div>
        <div class="data-card">
          <div class="text-xs text-slate-400 mb-2 font-semibold uppercase tracking-wide">PV Akım</div>
          <div class="metric-value text-amber-400" id="pvCurrent">-A</div>
        </div>
      </div>
      
      <div class="p-5 rounded-2xl bg-gradient-to-r from-amber-500/15 to-orange-500/15 border border-amber-500/25 mb-5">
        <div class="text-xs text-slate-400 mb-2 font-bold uppercase tracking-wide">Anlık PV Güç</div>
        <div class="text-5xl font-black text-amber-300" id="pvPower">-W</div>
      </div>
      
      <div class="chartwrap">
        <canvas id="chartSolar"></canvas>
      </div>
    </section>

    <!-- Quick Status -->
    <section class="col-span-12 lg:col-span-4 card p-7">
      <div class="flex items-center gap-4 mb-6">
        <div class="icon-box icon-gradient-1">
          <svg class="w-8 h-8 text-indigo-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
          </svg>
        </div>
        <h2 class="section-title">Hızlı Durum</h2>
      </div>
      
      <div class="space-y-4">
        <div class="data-card flex items-center justify-between p-5">
          <div>
            <div class="text-xs text-slate-400 mb-1 font-semibold uppercase tracking-wide">Sistem Modu</div>
            <div class="font-black text-xl text-indigo-300">Akıllı Otomasyon</div>
          </div>
          <div class="icon-box icon-gradient-1" style="width: 48px; height: 48px;">
            <svg class="w-6 h-6 text-indigo-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
              <circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6M5.6 5.6l4.2 4.2m4.4 4.4l4.2 4.2M1 12h6m6 0h6M5.6 18.4l4.2-4.2m4.4-4.4l4.2-4.2"/>
            </svg>
          </div>
        </div>
        
        <div class="data-card p-5">
          <div class="text-xs text-slate-400 mb-3 font-semibold uppercase tracking-wide">Ortam Durumu</div>
          <div class="flex items-center gap-4">
            <div class="icon-box icon-gradient-3" style="width: 48px; height: 48px;" id="ambientIconWrapper">
              <svg id="ambientIcon" class="w-6 h-6 text-amber-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                <circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/>
              </svg>
            </div>
            <div class="flex-1">
              <span class="font-bold text-lg" id="ambientText">Aydınlık</span>
              <span class="text-sm text-slate-400 block font-semibold" id="ambientLux">- lux</span>
            </div>
          </div>
        </div>
        
        <div class="data-card p-5">
          <div class="text-xs text-slate-400 mb-3 font-semibold uppercase tracking-wide">Hareket Sensörü</div>
          <div class="flex items-center gap-4">
            <div class="icon-box icon-gradient-4" style="width: 48px; height: 48px;" id="motionIconWrapper">
              <svg id="motionIcon" class="w-6 h-6 text-blue-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>
              </svg>
            </div>
            <span class="font-bold text-lg flex-1" id="motionText">-</span>
          </div>
        </div>
      </div>
    </section>
   <!-- BMS Cells -->
    <section class="col-span-12 lg:col-span-6 card p-7">
      <div class="flex items-center gap-4 mb-6">
        <div class="icon-box icon-gradient-2">
          <svg class="w-8 h-8 text-green-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <rect x="3" y="3" width="7" height="7" rx="1.5"/><rect x="14" y="3" width="7" height="7" rx="1.5"/>
            <rect x="14" y="14" width="7" height="7" rx="1.5"/><rect x="3" y="14" width="7" height="7" rx="1.5"/>
          </svg>
        </div>
        <h2 class="section-title">BMS Hücre Voltajları</h2>
      </div>
      
      <div class="grid grid-cols-2 gap-5 mb-5">
        <div class="p-6 rounded-2xl bg-gradient-to-br from-green-500/15 to-emerald-500/15 border border-green-500/25">
          <div class="text-xs text-slate-400 mb-2 font-bold uppercase tracking-wide">Hücre 1</div>
          <div class="text-4xl font-black text-green-400" id="cell1">-V</div>
        </div>
        <div class="p-6 rounded-2xl bg-gradient-to-br from-green-500/15 to-emerald-500/15 border border-green-500/25">
          <div class="text-xs text-slate-400 mb-2 font-bold uppercase tracking-wide">Hücre 2</div>
          <div class="text-4xl font-black text-green-400" id="cell2">-V</div>
        </div>
        <div class="p-6 rounded-2xl bg-gradient-to-br from-green-500/15 to-emerald-500/15 border border-green-500/25">
          <div class="text-xs text-slate-400 mb-2 font-bold uppercase tracking-wide">Hücre 3</div>
          <div class="text-4xl font-black text-green-400" id="cell3">-V</div>
        </div>
        <div class="p-6 rounded-2xl bg-gradient-to-br from-green-500/15 to-emerald-500/15 border border-green-500/25">
          <div class="text-xs text-slate-400 mb-2 font-bold uppercase tracking-wide">Hücre 4</div>
          <div class="text-4xl font-black text-green-400" id="cell4">-V</div>
        </div>
      </div>
      
      <div class="grid grid-cols-2 gap-4">
        <div class="data-card">
          <div class="text-xs text-slate-400 mb-1 font-semibold uppercase tracking-wide">Şarj MOS</div>
          <div class="text-xl font-bold" id="chargeMos">-</div>
        </div>
        <div class="data-card">
          <div class="text-xs text-slate-400 mb-1 font-semibold uppercase tracking-wide">Deşarj MOS</div>
          <div class="text-xl font-bold" id="dischargeMos">-</div>
        </div>
      </div>
    </section>

    <!-- Environment -->
    <section class="col-span-12 lg:col-span-6 card p-7">
      <div class="flex items-center gap-4 mb-6">
        <div class="icon-box icon-gradient-4">
          <svg class="w-8 h-8 text-blue-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/>
          </svg>
        </div>
        <h2 class="section-title">Ortam Sensörleri</h2>
      </div>
      
      <div class="grid grid-cols-2 gap-5 mb-5">
        <div class="p-6 rounded-2xl bg-gradient-to-br from-blue-500/15 to-cyan-500/15 border border-blue-500/25">
          <div class="text-xs text-slate-400 mb-2 font-bold uppercase tracking-wide">Sıcaklık</div>
          <div class="text-4xl font-black text-blue-300" id="temperature">-°C</div>
        </div>
        <div class="p-6 rounded-2xl bg-gradient-to-br from-cyan-500/15 to-teal-500/15 border border-cyan-500/25">
          <div class="text-xs text-slate-400 mb-2 font-bold uppercase tracking-wide">Nem</div>
          <div class="text-4xl font-black text-cyan-300" id="humidity">-%</div>
        </div>
        <div class="p-6 rounded-2xl bg-gradient-to-br from-purple-500/15 to-pink-500/15 border border-purple-500/25">
          <div class="text-xs text-slate-400 mb-2 font-bold uppercase tracking-wide">CO2</div>
          <div class="text-4xl font-black text-purple-300" id="co2">- ppm</div>
        </div>
        <div class="p-6 rounded-2xl bg-gradient-to-br from-amber-500/15 to-yellow-500/15 border border-amber-500/25">
          <div class="text-xs text-slate-400 mb-2 font-bold uppercase tracking-wide">Işık</div>
          <div class="text-4xl font-black text-amber-300" id="ldr">- lux</div>
        </div>
      </div>
      
      <div class="chartwrap">
        <canvas id="chartEnv"></canvas>
      </div>
    </section>

    <!-- Relay Control -->
    <section class="col-span-12 card p-7">
      <div class="flex items-center gap-4 mb-6">
        <div class="icon-box icon-gradient-5">
          <svg class="w-8 h-8 text-red-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <rect x="5" y="2" width="14" height="20" rx="2.5"/><path d="M9 6h6M9 10h6M9 14h6"/>
          </svg>
        </div>
        <h2 class="section-title">Röle Kontrol Sistemi</h2>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-5">
        <div id="relayEkran" class="relay-card p-7">
          <div class="flex items-center justify-between mb-5">
            <div class="icon-box icon-gradient-1">
              <svg class="w-7 h-7 text-indigo-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                <rect x="2" y="3" width="20" height="14" rx="2.5"/><path d="M8 21h8M12 17v4"/>
              </svg>
            </div>
            <span class="dot status-off"></span>
          </div>
          <div class="font-black text-2xl mb-2">Ekran</div>
          <div class="text-sm text-slate-400 mb-5 font-semibold uppercase tracking-wide">Display & Video</div>
          <div class="flex gap-3">
            <button class="btn flex-1">Aç</button>
            <button class="btn flex-1">Kapat</button>
          </div>
        </div>

        <div id="relayAydinlatma" class="relay-card p-7">
          <div class="flex items-center justify-between mb-5">
            <div class="icon-box icon-gradient-3">
              <svg class="w-7 h-7 text-amber-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                <path d="M15 2v5m0 0a3 3 0 1 1-6 0m6 0a3 3 0 1 0-6 0m0 0v12a3 3 0 1 0 6 0V7"/>
              </svg>
            </div>
            <span class="dot status-off"></span>
          </div>
          <div class="font-black text-2xl mb-2">Aydınlatma</div>
          <div class="text-sm text-slate-400 mb-5 font-semibold uppercase tracking-wide">LED Lighting</div>
          <div class="flex gap-3">
            <button class="btn flex-1">Aç</button>
            <button class="btn flex-1">Kapat</button>
          </div>
        </div>

        <div id="relaySarj" class="relay-card p-7">
          <div class="flex items-center justify-between mb-5">
            <div class="icon-box icon-gradient-2">
              <svg class="w-7 h-7 text-green-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                <path d="M9 18l3-3m0 0l3 3m-3-3v6m-6-9h12a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2z"/>
              </svg>
            </div>
            <span class="dot status-off"></span>
          </div>
          <div class="font-black text-2xl mb-2">Şarj Ünitesi</div>
          <div class="text-sm text-slate-400 mb-5 font-semibold uppercase tracking-wide">USB Charging</div>
          <div class="flex gap-3">
            <button class="btn flex-1">Aç</button>
            <button class="btn flex-1">Kapat</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Risk Analysis -->
    <section class="col-span-12 lg:col-span-6 card p-7">
      <div class="flex items-center gap-4 mb-6">
        <div class="icon-box icon-gradient-5">
          <svg class="w-8 h-8 text-red-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
            <path d="M12 9v4M12 17h.01"/>
          </svg>
        </div>
        <h2 class="section-title">Risk Analizi</h2>
      </div>
      <div class="space-y-3" id="riskList"></div>
    </section>

    <!-- Predictions -->
    <section class="col-span-12 lg:col-span-6 card p-7">
      <div class="flex items-center gap-4 mb-6">
        <div class="icon-box icon-gradient-1">
          <svg class="w-8 h-8 text-indigo-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/>
          </svg>
        </div>
        <h2 class="section-title">Tahminler & Öneriler</h2>
      </div>
      <div class="space-y-3" id="predictionList"></div>
    </section>

    <!-- Event Log -->
    <section class="col-span-12 card p-7">
      <div class="flex items-center gap-4 mb-6">
        <div class="icon-box icon-gradient-4">
          <svg class="w-8 h-8 text-blue-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/>
            <line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/>
          </svg>
        </div>
        <h2 class="section-title">Sistem Olayları</h2>
      </div>
      <div class="space-y-3 max-h-96 overflow-auto pr-2" id="eventLog"></div>
    </section>

  </main>

  <footer class="text-center py-6 text-slate-500 text-sm font-semibold">
    <div class="flex items-center justify-center gap-3">
      <img src="/static/logo.png" alt="NuTeknoloji" class="h-6 w-auto opacity-60" />
      <span>© 2025 NuTeknoloji • Smart IoT Solutions</span>
    </div>
  </footer>

  <script>
    const UPDATE_INTERVAL = 5000;
    let telemetryHistory = { solar: [], temp: [] };

    function updateClock() {
      document.getElementById('clock').textContent = new Date().toLocaleTimeString('tr-TR');
    }
    setInterval(updateClock, 1000);
    updateClock();

    function getBatteryStatus(soc) {
      if (soc <= 20) return { text: 'KRİTİK', class: 'chip-bad', progress: 'gradient-bad' };
      if (soc <= 25) return { text: 'DÜŞÜK', class: 'chip-bad', progress: 'gradient-bad' };
      if (soc <= 30) return { text: 'ORTA', class: 'chip-warn', progress: 'gradient-warn' };
      if (soc >= 40) return { text: 'NORMAL', class: 'chip-ok', progress: 'gradient-ok' };
      return { text: 'BELİRSİZ', class: 'chip-warn', progress: 'gradient-warn' };
    }

    function estimateBatteryTime(soc, current) {
      if (current >= 0) return '⚡ Şarj Oluyor';
      const capacity = 100;
      const remaining = (capacity * soc / 100);
      const hours = remaining / Math.abs(current);
      if (hours > 24) return `~${Math.round(hours / 24)} Gün`;
      if (hours > 1) return `~${Math.round(hours)} Saat`;
      return `~${Math.round(hours * 60)} Dakika`;
    }

    function analyzeRisks(data) {
      const risks = [];
      const soc = data.bms_battery_soc || 0;
      const temp = data.env_temperature || 20;
      const co2 = data.env_co2 || 400;

      if (soc <= 20) risks.push({ level: 'high', title: 'Kritik Batarya Seviyesi', desc: `SOC: ${soc}% - Acil şarj gerekli!` });
      else if (soc <= 30) risks.push({ level: 'med', title: 'Düşük Batarya', desc: `SOC: ${soc}% - Yük azaltma önerilir` });

      if (temp < 0) risks.push({ level: 'high', title: 'Düşük Sıcaklık', desc: `${temp}°C - Batarya performansı düşebilir` });
      else if (temp > 35) risks.push({ level: 'med', title: 'Yüksek Sıcaklık', desc: `${temp}°C - Soğutma gerekebilir` });

      if (co2 > 1000) risks.push({ level: 'med', title: 'Yüksek CO2', desc: `${co2} ppm - Havalandırma önerilir` });

      if (risks.length === 0) risks.push({ level: 'low', title: 'Tüm Sistemler Normal', desc: 'Risk tespit edilmedi ✓' });

      return risks;
    }

    function generatePredictions(data) {
      const predictions = [];
      const soc = data.bms_battery_soc || 0;
      const pvPower = data.mppt_pv_power || 0;

      if (soc > 80 && pvPower > 50) predictions.push({ title: 'Verimli Şarj', desc: 'Solar üretim yüksek, batarya şarj oluyor' });
      if (soc < 40 && pvPower < 10) predictions.push({ title: 'Gece Modu Önerisi', desc: 'Solar üretim düşük, enerji tasarrufu önerilir' });
      if (data.ldr_lux < 50 && !data.pir_motion_detected) predictions.push({ title: 'Otomasyon Aktif', desc: 'Karanlık ve hareket yok - Aydınlatma kapalı' });
      if (predictions.length === 0) predictions.push({ title: 'Stabil Çalışma', desc: 'Sistem optimal parametrelerde çalışıyor' });

      return predictions;
    }

    function addEvent(type, message) {
      const eventLog = document.getElementById('eventLog');
      const colorMap = { 
        info: 'from-blue-500/15 to-blue-500/5 border-blue-500/25', 
        warn: 'from-yellow-500/15 to-yellow-500/5 border-yellow-500/25', 
        error: 'from-red-500/15 to-red-500/5 border-red-500/25' 
      };
      
      const div = document.createElement('div');
      div.className = `p-4 rounded-xl bg-gradient-to-r ${colorMap[type] || colorMap.info} border flex items-center gap-4`;
      div.innerHTML = `
        <div class="w-10 h-10 rounded-lg bg-white/10 grid place-items-center font-bold">
          ${type === 'error' ? '!' : type === 'warn' ? '⚠' : 'i'}
        </div>
        <span class="flex-1 text-sm font-semibold">${message}</span>
        <span class="text-xs text-slate-500 font-semibold uppercase tracking-wider">${new Date().toLocaleTimeString('tr-TR')}</span>
      `;
      eventLog.insertBefore(div, eventLog.firstChild);
      while (eventLog.children.length > 15) eventLog.removeChild(eventLog.lastChild);
    }

    function updateRelayUI(relayId, isActive) {
      const relay = document.getElementById(relayId);
      const dot = relay.querySelector('.dot');
      
      if (isActive) {
        relay.classList.add('relay-active');
        dot.classList.remove('status-off');
        dot.classList.add('status-ok');
      } else {
        relay.classList.remove('relay-active');
        dot.classList.add('status-off');
        dot.classList.remove('status-ok');
      }
    }

    const chartConfig = {
      type: 'line',
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: { 
          x: { display: false }, 
          y: { 
            ticks: { color: '#94a3b8', font: { weight: '600' } }, 
            grid: { color: 'rgba(99,102,241,.1)' } 
          } 
        }
      }
    };

    const solarChart = new Chart(document.getElementById('chartSolar').getContext('2d'), {
      ...chartConfig,
      data: { labels: Array(20).fill(''), datasets: [{ 
        data: Array(20).fill(0), 
        borderColor: '#fbbf24', 
        borderWidth: 3, 
        tension: 0.4, 
        fill: true, 
        backgroundColor: 'rgba(251,191,36,0.1)' 
      }] }
    });

    const envChart = new Chart(document.getElementById('chartEnv').getContext('2d'), {
      ...chartConfig,
      data: { labels: Array(20).fill(''), datasets: [{ 
        data: Array(20).fill(0), 
        borderColor: '#60a5fa', 
        borderWidth: 3, 
        tension: 0.4, 
        fill: true, 
        backgroundColor: 'rgba(96,165,250,0.1)' 
      }] }
    });

    async function updateData() {
      try {
        const response = await fetch('/telemetry.json');
        const data = await response.json();

        document.getElementById('headerLocation').textContent = `${data.location || 'Bilinmiyor'} • ${data.device_id || '-'}`;
        document.getElementById('deviceChip').textContent = `DEVICE: ${data.device_id || '-'}`;

        const soc = data.bms_battery_soc || 0;
        const status = getBatteryStatus(soc);
        document.getElementById('bmsSoc').textContent = soc + '%';
        document.getElementById('batteryChip').textContent = status.text;
        document.getElementById('batteryChip').className = status.class;
        document.getElementById('batteryProgress').style.width = soc + '%';
        document.getElementById('batteryProgress').className = `progress-fill ${status.progress}`;
        document.getElementById('bmsVoltage').textContent = (data.bms_battery_voltage || 0).toFixed(2) + 'V';
        document.getElementById('bmsCurrent').textContent = (data.bms_battery_current || 0).toFixed(2) + 'A';
        document.getElementById('bmsPower').textContent = (data.bms_battery_power || 0).toFixed(1) + 'W';
        document.getElementById('bmsSoh').textContent = (data.bms_battery_soh || 0) + '%';
        document.getElementById('batteryEstimate').textContent = estimateBatteryTime(soc, data.bms_battery_current || 0);

        document.getElementById('pvVoltage').textContent = (data.mppt_pv_voltage || 0).toFixed(1) + 'V';
        document.getElementById('pvCurrent').textContent = (data.mppt_pv_current || 0).toFixed(2) + 'A';
        document.getElementById('pvPower').textContent = (data.mppt_pv_power || 0).toFixed(1) + 'W';

        document.getElementById('cell1').textContent = (data.bms_cell_1_voltage || 0).toFixed(3) + 'V';
        document.getElementById('cell2').textContent = (data.bms_cell_2_voltage || 0).toFixed(3) + 'V';
        document.getElementById('cell3').textContent = (data.bms_cell_3_voltage || 0).toFixed(3) + 'V';
        document.getElementById('cell4').textContent = (data.bms_cell_4_voltage || 0).toFixed(3) + 'V';
        document.getElementById('chargeMos').textContent = data.bms_charge_mos_status || '-';
        document.getElementById('dischargeMos').textContent = data.bms_discharge_mos_status || '-';

        document.getElementById('temperature').textContent = (data.env_temperature || 0).toFixed(1) + '°C';
        document.getElementById('humidity').textContent = (data.env_humidity || 0).toFixed(1) + '%';
        document.getElementById('co2').textContent = (data.env_co2 || 0) + ' ppm';
        document.getElementById('ldr').textContent = (data.ldr_lux || 0) + ' lux';
        document.getElementById('ambientLux').textContent = (data.ldr_lux || 0) + ' lux';

        const isLight = data.ldr_lux > 50;
        document.getElementById('ambientText').textContent = isLight ? 'Aydınlık' : 'Karanlık';

        const hasMotion = data.pir_motion_detected;
        document.getElementById('motionText').textContent = hasMotion ? 'Hareket Var' : 'Hareket Yok';

        updateRelayUI('relayEkran', soc >= 30);
        updateRelayUI('relayAydinlatma', hasMotion && !isLight);
        updateRelayUI('relaySarj', soc >= 25);

        const risks = analyzeRisks(data);
        document.getElementById('riskList').innerHTML = risks.map(r => {
          const badgeClass = r.level === 'high' ? 'risk-high' : r.level === 'med' ? 'risk-med' : 'risk-low';
          return `
            <div class="data-card p-5 hover:bg-white/5 transition-all cursor-pointer">
              <div class="flex items-start gap-4">
                <span class="risk-badge ${badgeClass}">${r.level === 'high' ? 'HIGH' : r.level === 'med' ? 'MED' : 'LOW'}</span>
                <div class="flex-1">
                  <div class="font-bold text-lg mb-1">${r.title}</div>
                  <div class="text-sm text-slate-400 font-medium">${r.desc}</div>
                </div>
              </div>
            </div>
          `;
        }).join('');

        const predictions = generatePredictions(data);
        document.getElementById('predictionList').innerHTML = predictions.map(p => `
          <div class="data-card p-5 hover:bg-white/5 transition-all cursor-pointer">
            <div class="font-bold text-lg mb-1">${p.title}</div>
            <div class="text-sm text-slate-400 font-medium">${p.desc}</div>
          </div>
        `).join('');

        telemetryHistory.solar.push(data.mppt_pv_power || 0);
        if (telemetryHistory.solar.length > 20) telemetryHistory.solar.shift();
        solarChart.data.datasets[0].data = telemetryHistory.solar;
        solarChart.update();

        telemetryHistory.temp.push(data.env_temperature || 0);
        if (telemetryHistory.temp.length > 20) telemetryHistory.temp.shift();
        envChart.data.datasets[0].data = telemetryHistory.temp;
        envChart.update();

        document.getElementById('statusDot').className = 'dot status-ok';
        document.getElementById('statusText').textContent = 'Online';

      } catch (error) {
        console.error('Update error:', error);
        document.getElementById('statusDot').className = 'dot status-bad';
        document.getElementById('statusText').textContent = 'Offline';
        addEvent('error', 'Veri güncellenemedi: ' + error.message);
      }
    }

    updateData();
    setInterval(updateData, UPDATE_INTERVAL);
    addEvent('info', 'NuBank Dashboard başlatıldı');
  </script>
</body>
</html>









































